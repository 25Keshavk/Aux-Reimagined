{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/keshuk/Desktop/Aux-Reimagined/app/api/apple-music/developer-token/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { SignJWT, importPKCS8 } from \"jose\";\n\nexport const runtime = \"nodejs\";\n\ntype Cache = { token: string; expMs: number };\nconst g = globalThis as unknown as { __amCache?: Cache };\n\nfunction must(name: string): string {\n  const v = process.env[name];\n  if (!v) throw new Error(`Missing env var: ${name}`);\n  return v;\n}\n\nexport async function GET() {\n  const TEAM_ID = must(\"APPLE_MUSIC_TEAM_ID\");\n  const KEY_ID = must(\"APPLE_MUSIC_KEY_ID\");\n  const KEY_B64 = must(\"APPLE_MUSIC_KEY_B64\");\n  const ORIGIN = process.env.APPLE_MUSIC_ORIGIN;\n\n  const now = Date.now();\n  if (g.__amCache && now < g.__amCache.expMs - 5 * 60 * 1000) {\n    return NextResponse.json({ token: g.__amCache.token });\n  }\n\n  const privateKeyPem = Buffer.from(KEY_B64, \"base64\").toString(\"utf8\");\n\n  const iat = Math.floor(now / 1000);\n  const exp = iat + 60 * 60 * 24 * 30; // 30 days\n\n  const key = await importPKCS8(privateKeyPem, \"ES256\");\n\n  const jwt = await new SignJWT(ORIGIN ? { origin: ORIGIN } : {})\n    .setProtectedHeader({ alg: \"ES256\", kid: KEY_ID })\n    .setIssuer(TEAM_ID)\n    .setIssuedAt(iat)\n    .setExpirationTime(exp)\n    .sign(key);\n\n  g.__amCache = { token: jwt, expMs: exp * 1000 };\n  return NextResponse.json({ token: jwt });\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;;;AAEO,MAAM,UAAU;AAGvB,MAAM,IAAI;AAEV,SAAS,KAAK,IAAY;IACxB,MAAM,IAAI,QAAQ,GAAG,CAAC,KAAK;IAC3B,IAAI,CAAC,GAAG,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,MAAM;IAClD,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,UAAU,KAAK;IACrB,MAAM,SAAS,KAAK;IACpB,MAAM,UAAU,KAAK;IACrB,MAAM,SAAS,QAAQ,GAAG,CAAC,kBAAkB;IAE7C,MAAM,MAAM,KAAK,GAAG;IACpB,IAAI,EAAE,SAAS,IAAI,MAAM,EAAE,SAAS,CAAC,KAAK,GAAG,IAAI,KAAK,MAAM;QAC1D,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,EAAE,SAAS,CAAC,KAAK;QAAC;IACtD;IAEA,MAAM,gBAAgB,OAAO,IAAI,CAAC,SAAS,UAAU,QAAQ,CAAC;IAE9D,MAAM,MAAM,KAAK,KAAK,CAAC,MAAM;IAC7B,MAAM,MAAM,MAAM,KAAK,KAAK,KAAK,IAAI,UAAU;IAE/C,MAAM,MAAM,MAAM,IAAA,wKAAW,EAAC,eAAe;IAE7C,MAAM,MAAM,MAAM,IAAI,kKAAO,CAAC,SAAS;QAAE,QAAQ;IAAO,IAAI,CAAC,GAC1D,kBAAkB,CAAC;QAAE,KAAK;QAAS,KAAK;IAAO,GAC/C,SAAS,CAAC,SACV,WAAW,CAAC,KACZ,iBAAiB,CAAC,KAClB,IAAI,CAAC;IAER,EAAE,SAAS,GAAG;QAAE,OAAO;QAAK,OAAO,MAAM;IAAK;IAC9C,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAI;AACxC"}}]
}