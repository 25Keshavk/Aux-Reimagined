{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/keshuk/Desktop/Aux-Reimagined/lib/rooms.ts"],"sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\n\nexport type Track = {\n  id: string;        // Apple Music song id\n  name: string;\n  artist: string;\n  artworkUrl?: string;\n  votes: number;\n  addedAt: number;   // ms timestamp\n};\n\nexport type Room = {\n  id: string;\n  createdAt: number;\n  queue: Track[];\n  nowPlaying?: Track;\n};\n\ntype Store = Record<string, Room>;\n\nconst DATA_DIR = path.join(process.cwd(), \".data\");\nconst STORE_FILE = path.join(DATA_DIR, \"rooms.json\");\n\nfunction ensureDir() {\n  if (!fs.existsSync(DATA_DIR)) fs.mkdirSync(DATA_DIR, { recursive: true });\n}\n\nfunction loadStore(): Store {\n  ensureDir();\n  if (!fs.existsSync(STORE_FILE)) return {};\n  try {\n    const raw = fs.readFileSync(STORE_FILE, \"utf8\");\n    if (!raw.trim()) return {};\n    return JSON.parse(raw) as Store;\n  } catch {\n    return {};\n  }\n}\n\nfunction saveStore(store: Store) {\n  ensureDir();\n  fs.writeFileSync(STORE_FILE, JSON.stringify(store, null, 2), \"utf8\");\n}\n\nfunction randCode(len = 6) {\n  const chars = \"ABCDEFGHJKLMNPQRSTUVWXYZ23456789\";\n  let s = \"\";\n  for (let i = 0; i < len; i++) s += chars[Math.floor(Math.random() * chars.length)];\n  return s;\n}\n\nexport function createRoom(): Room {\n  const store = loadStore();\n  let id = randCode(6);\n  while (store[id]) id = randCode(6);\n\n  const room: Room = { id, createdAt: Date.now(), queue: [] };\n  store[id] = room;\n  saveStore(store);\n  return room;\n}\n\nexport function getRoom(id: string): Room | null {\n  const store = loadStore();\n  return store[id] ?? null;\n}\n\nexport function addTrack(roomId: string, t: Omit<Track, \"votes\" | \"addedAt\">): Room {\n  const store = loadStore();\n  const room = store[roomId];\n  if (!room) throw new Error(\"Room not found\");\n\n  const exists = room.queue.find(x => x.id === t.id) || (room.nowPlaying?.id === t.id);\n  if (!exists) {\n    room.queue.push({ ...t, votes: 0, addedAt: Date.now() });\n  }\n\n  store[roomId] = room;\n  saveStore(store);\n  return room;\n}\n\nexport function vote(roomId: string, trackId: string, delta: number): Room {\n  const store = loadStore();\n  const room = store[roomId];\n  if (!room) throw new Error(\"Room not found\");\n\n  const tr = room.queue.find(x => x.id === trackId);\n  if (!tr) throw new Error(\"Track not in queue\");\n\n  tr.votes += delta;\n\n  store[roomId] = room;\n  saveStore(store);\n  return room;\n}\n\nexport function nextTrack(roomId: string): { room: Room; next: Track | null } {\n  const store = loadStore();\n  const room = store[roomId];\n  if (!room) throw new Error(\"Room not found\");\n\n  if (room.queue.length === 0) {\n    saveStore(store);\n    return { room, next: null };\n  }\n\n  room.queue.sort((a, b) => (b.votes - a.votes) || (a.addedAt - b.addedAt));\n  const next = room.queue.shift()!;\n  room.nowPlaying = next;\n\n  store[roomId] = room;\n  saveStore(store);\n  return { room, next };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 171, "column": 0}, "map": {"version":3,"sources":["file:///Users/keshuk/Desktop/Aux-Reimagined/app/api/rooms/%5BroomId%5D/next/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { nextTrack } from \"../../../../../lib/rooms\";\n\nexport const runtime = \"nodejs\";\n\nexport async function POST(_req: Request, ctx: { params: Promise<{ roomId: string }> }) {\n  const { roomId } = await ctx.params;\n  const idRoom = (roomId ?? \"\").toUpperCase();\n\n  try {\n    const { room, next } = nextTrack(idRoom);\n    return NextResponse.json({ room, next });\n  } catch (e: any) {\n    return NextResponse.json({ error: e?.message ?? \"Error\" }, { status: 404 });\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,MAAM,UAAU;AAEhB,eAAe,KAAK,IAAa,EAAE,GAA4C;IACpF,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,MAAM;IACnC,MAAM,SAAS,CAAC,UAAU,EAAE,EAAE,WAAW;IAEzC,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,IAAA,2HAAS,EAAC;QACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;YAAM;QAAK;IACxC,EAAE,OAAO,GAAQ;QACf,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,GAAG,WAAW;QAAQ,GAAG;YAAE,QAAQ;QAAI;IAC3E;AACF"}}]
}