{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/keshuk/Desktop/Aux-Reimagined/lib/rooms.ts"],"sourcesContent":["export type Track = {\n  id: string;        // Apple Music song id\n  name: string;\n  artist: string;\n  artworkUrl?: string;\n  votes: number;\n  addedAt: number;   // ms timestamp\n};\n\nexport type Room = {\n  id: string;\n  createdAt: number;\n  queue: Track[];\n  nowPlaying?: Track;\n};\n\ntype Store = Map<string, Room>;\n\nconst g = globalThis as unknown as { __rooms?: Store };\n\nfunction store(): Store {\n  if (!g.__rooms) g.__rooms = new Map();\n  return g.__rooms;\n}\n\nfunction randCode(len = 6) {\n  const chars = \"ABCDEFGHJKLMNPQRSTUVWXYZ23456789\";\n  let s = \"\";\n  for (let i = 0; i < len; i++) s += chars[Math.floor(Math.random() * chars.length)];\n  return s;\n}\n\nexport function createRoom(): Room {\n  const s = store();\n  let id = randCode(6);\n  while (s.has(id)) id = randCode(6);\n\n  const room: Room = { id, createdAt: Date.now(), queue: [] };\n  s.set(id, room);\n  return room;\n}\n\nexport function getRoom(id: string): Room | null {\n  return store().get(id) ?? null;\n}\n\nexport function addTrack(roomId: string, t: Omit<Track, \"votes\" | \"addedAt\">): Room {\n  const room = getRoom(roomId);\n  if (!room) throw new Error(\"Room not found\");\n\n  const exists = room.queue.find(x => x.id === t.id) || (room.nowPlaying?.id === t.id);\n  if (!exists) {\n    room.queue.push({ ...t, votes: 0, addedAt: Date.now() });\n  }\n  return room;\n}\n\nexport function vote(roomId: string, trackId: string, delta: number): Room {\n  const room = getRoom(roomId);\n  if (!room) throw new Error(\"Room not found\");\n\n  const tr = room.queue.find(x => x.id === trackId);\n  if (!tr) throw new Error(\"Track not in queue\");\n  tr.votes += delta;\n  return room;\n}\n\nexport function nextTrack(roomId: string): { room: Room; next: Track | null } {\n  const room = getRoom(roomId);\n  if (!room) throw new Error(\"Room not found\");\n\n  if (room.queue.length === 0) return { room, next: null };\n\n  // sort: highest votes first; tie-breaker: earlier added first\n  room.queue.sort((a, b) => (b.votes - a.votes) || (a.addedAt - b.addedAt));\n  const next = room.queue.shift()!;\n  room.nowPlaying = next;\n  return { room, next };\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAkBA,MAAM,IAAI;AAEV,SAAS;IACP,IAAI,CAAC,EAAE,OAAO,EAAE,EAAE,OAAO,GAAG,IAAI;IAChC,OAAO,EAAE,OAAO;AAClB;AAEA,SAAS,SAAS,MAAM,CAAC;IACvB,MAAM,QAAQ;IACd,IAAI,IAAI;IACR,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,IAAK,KAAK,KAAK,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,MAAM,MAAM,EAAE;IAClF,OAAO;AACT;AAEO,SAAS;IACd,MAAM,IAAI;IACV,IAAI,KAAK,SAAS;IAClB,MAAO,EAAE,GAAG,CAAC,IAAK,KAAK,SAAS;IAEhC,MAAM,OAAa;QAAE;QAAI,WAAW,KAAK,GAAG;QAAI,OAAO,EAAE;IAAC;IAC1D,EAAE,GAAG,CAAC,IAAI;IACV,OAAO;AACT;AAEO,SAAS,QAAQ,EAAU;IAChC,OAAO,QAAQ,GAAG,CAAC,OAAO;AAC5B;AAEO,SAAS,SAAS,MAAc,EAAE,CAAmC;IAC1E,MAAM,OAAO,QAAQ;IACrB,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;IAE3B,MAAM,SAAS,KAAK,KAAK,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,EAAE,EAAE,KAAM,KAAK,UAAU,EAAE,OAAO,EAAE,EAAE;IACnF,IAAI,CAAC,QAAQ;QACX,KAAK,KAAK,CAAC,IAAI,CAAC;YAAE,GAAG,CAAC;YAAE,OAAO;YAAG,SAAS,KAAK,GAAG;QAAG;IACxD;IACA,OAAO;AACT;AAEO,SAAS,KAAK,MAAc,EAAE,OAAe,EAAE,KAAa;IACjE,MAAM,OAAO,QAAQ;IACrB,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;IAE3B,MAAM,KAAK,KAAK,KAAK,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IACzC,IAAI,CAAC,IAAI,MAAM,IAAI,MAAM;IACzB,GAAG,KAAK,IAAI;IACZ,OAAO;AACT;AAEO,SAAS,UAAU,MAAc;IACtC,MAAM,OAAO,QAAQ;IACrB,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;IAE3B,IAAI,KAAK,KAAK,CAAC,MAAM,KAAK,GAAG,OAAO;QAAE;QAAM,MAAM;IAAK;IAEvD,8DAA8D;IAC9D,KAAK,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,IAAM,AAAC,EAAE,KAAK,GAAG,EAAE,KAAK,IAAM,EAAE,OAAO,GAAG,EAAE,OAAO;IACvE,MAAM,OAAO,KAAK,KAAK,CAAC,KAAK;IAC7B,KAAK,UAAU,GAAG;IAClB,OAAO;QAAE;QAAM;IAAK;AACtB"}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///Users/keshuk/Desktop/Aux-Reimagined/app/api/rooms/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { createRoom } from \"../../../lib/rooms\";\n\nexport const runtime = \"nodejs\";\n\nexport async function POST() {\n  const room = createRoom();\n  return NextResponse.json({ roomId: room.id });\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,MAAM,UAAU;AAEhB,eAAe;IACpB,MAAM,OAAO,IAAA,4HAAU;IACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,QAAQ,KAAK,EAAE;IAAC;AAC7C"}}]
}